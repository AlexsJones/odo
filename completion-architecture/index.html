<!DOCTYPE html>
<html>

  <head>

  <!-- Viewing -->
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="website" property="og:type">


  <!-- Descriptions -->
  <meta name="description" content="OpenShift Do
">
  <title>Completion architecture</title>


  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <link rel="manifest" href="/img/manifest.json">
  <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="shortcut icon" href="/img/favicon.ico">
  <meta name="msapplication-config" content="/img/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">


  <!-- HLJS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js">
  </script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <!-- ANALYTICS -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119021845-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-119021845-1');
  </script>

</head>


  <!-- CSS -->
  <link href="/css/default.css" rel="stylesheet" type="text/css">
  <link href="/css/pilcrow.css" rel="stylesheet" type="text/css">

<body>

  <header>
    <a class="logo" href="/">
      <img class="parcel" src="/img/logo.png" height="30"alt="">
    </a>
    <div class="links">
      <a href="/getting-started">Documentation</a> <a href="https://github.com/openshift/odo" target="_blank">GitHub</a>
    </div>
  </header>

  <div class="content">
    <nav>
      <h3>Documentation</h3>
      <ul>
        
          
            <li><a href="/getting-started/">Getting Started</a></li>
          
        
          
            <li><a href="/installation/">Installation</a></li>
          
        
          
            <li><a href="/examples/">Examples</a></li>
          
        
      </ul>
      <h3>Advanced</h3>
      <ul>
        
          
            <li><a href="/cli-reference/">CLI Reference</a></li>
          
        
      </ul>
      <h3>Development</h3>
      <ul>
        
          
            <li><a href="/development/">Development</a></li>
          
        
          
            <li><a href="/tdd-workflow/">TDD Workflow</a></li>
          
        
          
            <li><a class="active" href="/completion-architecture/">Completion Architecture</a></li>
          
        
          
            <li><a href="/logging/">Logging</a></li>
          
        
      </ul>
    </nav>


    <main>

    <h1>Completion architecture</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>odo</code> provides smart completion of command names, arguments and flags when typing commands. The completion architecture allows for completion handlers (i.e. pieces of code that provide the suggestions to the shell running the command) to be written entirely in go. This document describes the architecture, how to develop new completion handlers and
how to activate/deactivate completions for <code>odo</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The completion architecture relies on the <a href="https://github.com/posener/complete"><code>posener/complete</code></a> project.
<code>posener/complete</code> relies on providing implementations of their <code>Predictor</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-go" data-lang="go">type Predictor interface {
    Predict(Args) []string
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These implementations are then bound to a <code>complete.Command</code> which describes how commands are supposed to be completed by the shell. While
it is possible to create an external application simply for the purpose of providing completions, it made more sense for <code>odo</code> to have <code>odo`itself deal with exposing possible completions. In this case, we need to hook into the `cobra</code> command lifecycle and expose completion information before <code>cobra</code> takes over. This happens in the main entry point for the <code>odo</code> application. Completion information is provided by the <code>createCompletion</code> function which walks the <code>cobra</code> command tree and creates the <code>complete.Command</code> tree as it goes along, attaching completion handler to commands (for arguments) and flags.</p>
</div>
<div class="paragraph">
<p>In order to provide this information, <code>odo</code> allows commands to register completion handlers for their arguments and flags using <code>completion.RegisterCommandHandler</code> and
<code>completion.RegisterCommandFlagHandler</code> respectively. These functions will adapt the contextualized predictor that we expose to commands to the <code>posener/complete</code> <code>Predictor</code> interface internally.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-new-completion-handler">Create a new completion handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s take the example of the <code>odo service delete</code> command. The command expects a service name as an argument. In order to provide automatic completion, the command will register a completion handler as follows:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-completion-contextualizedpredictor-implementation">Create a <code>completion.ContextualizedPredictor</code> implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>completion.ContextualizedPredictor</code> is defined as
<code>type ContextualizedPredictor func(cmd *cobra.Command, args parsedArgs, context *genericclioptions.Context) []string</code>
which is a function which should return an array of possible completion strings based on the given arguments.</p>
</div>
<div class="paragraph">
<p>This function should be put in <code>pkg/odo/util/completion/completionhandlers.go</code> so that it could be reused across commands.</p>
</div>
<div class="paragraph">
<p>While filtering is done by <code>posener/complete</code> itself, automatically removing all completions not prefixed by what you’ve typed already, it might be useful to use the values provided by <code>parsedArgs</code> to help optimize things to avoid repeating possible completions for example.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="register-the-completion-handler">Register the completion handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The command should register the appropriate completion handler using <code>completion.RegisterCommandHandler(command *cobra.Command, predictor ContextualizedPredictor)</code> in the case of an argument completion handler or using <code>completion.RegisterCommandFlagHandler(command *cobra.Command, flag string, predictor ContextualizedPredictor)</code>
in the case of a flag completion handler. Registering the completion handler will make it available for <code>main.createCompletion</code> which will then automatically create the completion information from it.</p>
</div>
</div>
</div>

    </main>
  </div>
</body>

</html>
